# سكريبتات الاستعادة من Git وتحديث قاعدة البيانات

هذا المجلد يحتوي على سكريبتات عكسية لاستعادة المشروع من Git وتحديث قاعدة البيانات من النسخة الاحتياطية.

## الملفات المتوفرة

1. **`restore_from_git.sh`** - سكريبت Bash لنظام Linux/Mac/Git Bash
2. **`restore_from_git.bat`** - سكريبت Batch لنظام Windows
3. **`restore_from_git.php`** - سكريبت PHP (يعمل على جميع الأنظمة)

## المتطلبات

### للـ Bash Script (Linux/Mac/Git Bash):
- `mysql` أو `psql` (حسب نوع قاعدة البيانات)
- `gunzip` لفك الضغط
- `git` مثبت ومضبوط

### للـ Batch Script (Windows):
- `mysql` أو `psql` في PATH
- `git` مثبت ومضبوط
- PowerShell (مدمج في Windows)

### للـ PHP Script:
- PHP 7.4 أو أحدث
- `mysql` أو `psql` في PATH
- `git` مثبت ومضبوط
- إمكانية تنفيذ الأوامر من PHP

## الاستخدام

### Linux/Mac/Git Bash:
```bash
./restore_from_git.sh
```

### Windows (Command Prompt):
```cmd
restore_from_git.bat
```

### Windows (PowerShell):
```powershell
.\restore_from_git.bat
```

### PHP (جميع الأنظمة):
```bash
php restore_from_git.php
```

## ما يقوم به السكريبت

1. ✅ البحث عن أحدث نسخة احتياطية في مجلد `database_backups/`
2. ✅ استعادة المشروع من Git (git pull)
3. ✅ فك الضغط إذا كان الملف مضغوطاً
4. ✅ التحذير قبل استبدال قاعدة البيانات
5. ✅ استعادة قاعدة البيانات من النسخة الاحتياطية
6. ✅ تنظيف الملفات المؤقتة

## خطوات العملية

### 1. البحث عن النسخة الاحتياطية
- يبحث السكريبت تلقائياً عن أحدث ملف backup
- يدعم الملفات المضغوطة (`.sql.gz`) وغير المضغوطة (`.sql`)
- يختار الملف الأحدث تلقائياً

### 2. استعادة من Git
- يقوم بعمل `git pull` من الفرع الحالي
- إذا فشل pull، يستمر مع استعادة قاعدة البيانات

### 3. فك الضغط
- إذا كان الملف مضغوطاً، يقوم بفك الضغط تلقائياً
- يستخدم الملف المؤقت للاستعادة

### 4. استعادة قاعدة البيانات
- **MySQL/MariaDB**: يستخدم `mysql` لاستعادة البيانات
- **PostgreSQL**: يستخدم `psql` لاستعادة البيانات
- **تحذير**: سيتم استبدال قاعدة البيانات الحالية بالكامل

## مثال على الاستخدام

```bash
# على Linux/Mac
./restore_from_git.sh

# على Windows
restore_from_git.bat

# باستخدام PHP
php restore_from_git.php
```

## التحذيرات المهمة

⚠️ **تحذير**: السكريبتات تستبدل قاعدة البيانات الحالية بالكامل!

- تأكد من وجود نسخة احتياطية من قاعدة البيانات الحالية قبل الاستعادة
- تأكد من أن النسخة الاحتياطية المختارة هي الصحيحة
- السكريبت يطلب تأكيد قبل الاستعادة

## استكشاف الأخطاء

### خطأ: "لم يتم العثور على أي نسخة احتياطية"
- تأكد من وجود مجلد `database_backups/`
- تأكد من وجود ملفات `.sql` أو `.sql.gz` في المجلد
- تحقق من صلاحيات القراءة

### خطأ: "mysql: command not found"
- تأكد من تثبيت MySQL Client
- أضف مسار MySQL إلى PATH

### خطأ: "psql: command not found"
- تأكد من تثبيت PostgreSQL Client
- أضف مسار PostgreSQL إلى PATH

### خطأ: "Git pull failed"
- تحقق من اتصال الإنترنت
- تحقق من إعدادات Git remote
- تحقق من وجود تغييرات محلية غير محفوظة

### خطأ: "فشل استعادة قاعدة البيانات"
- تحقق من إعدادات قاعدة البيانات في `.env`
- تأكد من أن قاعدة البيانات موجودة
- تحقق من صلاحيات المستخدم
- تحقق من أن قاعدة البيانات فارغة أو أنك تريد استبدالها

## نصائح الاستخدام

1. **قبل الاستعادة**:
   - خذ نسخة احتياطية من قاعدة البيانات الحالية
   - تأكد من أن جميع التغييرات المحلية محفوظة
   - راجع محتوى النسخة الاحتياطية إذا أمكن

2. **أثناء الاستعادة**:
   - اقرأ التحذيرات بعناية
   - تأكد من اختيار النسخة الاحتياطية الصحيحة
   - لا تقاطع العملية أثناء التنفيذ

3. **بعد الاستعادة**:
   - تحقق من أن قاعدة البيانات تم استعادتها بشكل صحيح
   - اختبر التطبيق للتأكد من أن كل شيء يعمل
   - راجع السجلات إذا واجهت مشاكل

## التكامل مع سكريبتات النسخ الاحتياطي

هذه السكريبتات تعمل بشكل متكامل مع سكريبتات النسخ الاحتياطي (`backup_and_push`):

1. استخدم `backup_and_push` لأخذ نسخة احتياطية ورفعها على Git
2. استخدم `restore_from_git` لاستعادة المشروع وقاعدة البيانات

## مثال على سيناريو كامل

```bash
# 1. أخذ نسخة احتياطية ورفع على Git
./backup_and_push.sh

# 2. في مكان آخر، استعادة المشروع وقاعدة البيانات
./restore_from_git.sh
```

## الدعم

إذا واجهت أي مشاكل:
1. راجع رسائل الخطأ بعناية
2. تحقق من إعدادات قاعدة البيانات في `.env`
3. تحقق من إعدادات Git
4. راجع السجلات والملفات المؤقتة

