# ุงุฎุชุจุงุฑุงุช ูุธุงู ุงูุดุงุช

## ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅูุดุงุก ูุธุงู ุงุฎุชุจุงุฑ ุดุงูู ููุชุญูู ูู ุนูู ูุธุงู ุงูุดุงุช ุจุดูู ุตุญูุญ. ูุชุถูู ุงููุธุงู:

1. โ ุฅุตูุงุญ ูุดููุฉ ุฅุฑุณุงู ุงูุฑุณุงุฆู (ุถูุงู ุฅุฑุฌุงุน JSON ูููุณ HTML)
2. โ ุฅูุดุงุก ุญุณุงุจ ูููู ููุงุฎุชุจุงุฑ
3. โ ุฅูุดุงุก ุดุงุช ุจูู ุงูุญุณุงุจ ุงููููู ูุงููุณุชุฎุฏู "Madonna 847"
4. โ ุงุฎุชุจุงุฑุงุช ุดุงููุฉ ููุชุญูู ูู ุนูู ุงููุธุงู

## ุงููููุงุช ุงููููุดุฃุฉ

### 1. Command: `CreateTestChat`
**ุงููููุน:** `/root/CRM/app/Console/Commands/CreateTestChat.php`

**ุงููุตู:** ุฃูุฑ Artisan ูุฅูุดุงุก ุญุณุงุจ ูููู ูุฅูุดุงุก ุดุงุช ุจููู ูุจูู ูุณุชุฎุฏู ูุญุฏุฏ.

**ุงูุงุณุชุฎุฏุงู:**
```bash
# ุฅูุดุงุก ุดุงุช ูุน ูุณุชุฎุฏู Madonna ุชููุงุฆูุงู
php artisan chat:create-test

# ุฅูุดุงุก ุดุงุช ูุน ูุณุชุฎุฏู ูุญุฏุฏ
php artisan chat:create-test --user-id=120
```

### 2. ุงุฎุชุจุงุฑ PHP
**ุงููููุน:** `/root/CRM/tests/chat_test.php`

**ุงููุตู:** ุงุฎุชุจุงุฑ ุดุงูู ูุชุญูู ูู:
- ูุฌูุฏ ุงูุญุณุงุจ ุงููููู
- ูุฌูุฏ ูุณุชุฎุฏู Madonna
- ูุฌูุฏ ุงูุดุงุช ุจููููุง
- ุฅุฑุณุงู ุงูุฑุณุงุฆู
- ุนูู API endpoint

**ุงูุงุณุชุฎุฏุงู:**
```bash
php tests/chat_test.php
```

### 3. ุงุฎุชุจุงุฑ Playwright (ููุงุณุชุฎุฏุงู ุงููุณุชูุจูู)
**ุงููููุน:** `/root/CRM/tests/chat_test_playwright.js`

**ุงููุตู:** ุงุฎุชุจุงุฑ E2E ุจุงุณุชุฎุฏุงู Playwright ููุชุญูู ูู ุนูู ุงูุดุงุช ูู ุงููุฑููุช.

**ุงูุงุณุชุฎุฏุงู:**
```bash
# ูุชุทูุจ ุชุซุจูุช Node.js ู Playwright ุฃููุงู
npm install playwright --save-dev
npx playwright install chromium
node tests/chat_test_playwright.js
```

## ุงูุฅุตูุงุญุงุช ุงูููููุฐุฉ

### 1. ุฅุตูุงุญ ูุดููุฉ ุฅุฑุฌุงุน HTML ุจุฏูุงู ูู JSON

**ุงููุดููุฉ:** ูุงู ุงูุณูุฑูุฑ ูุฑุฌุน HTML ุนูุฏ ุญุฏูุซ ุฎุทุฃ ูู ุฅุฑุณุงู ุงูุฑุณุงูุฉ.

**ุงูุญู:** ุชู ุฅุถุงูุฉ:
- ูุนุงูุฌุฉ ุดุงููุฉ ููุฃุฎุทุงุก ูู `sendStaticMessage`
- ุถูุงู ุฅุฑุฌุงุน JSON ุฏุงุฆูุงู ุญุชู ุนูุฏ ุญุฏูุซ ุฃุฎุทุงุก
- ุฅุถุงูุฉ `Content-Type: application/json` ูู ุฌููุน ุงูุงุณุชุฌุงุจุงุช
- ุงูุชุญูู ูู ุตูุงุญูุงุช ุงููุณุชุฎุฏู ูุจู ุฅุฑุณุงู ุงูุฑุณุงูุฉ

**ุงูููู ุงูููุนุฏู:** `/root/CRM/app/Http/Controllers/ChatController.php`

### 2. ุฅุตูุงุญ ูุดููุฉ ุนููุฏ `unread_count`

**ุงููุดููุฉ:** ุงูุนููุฏ `unread_count` ุบูุฑ ููุฌูุฏ ูู ุจุนุถ ููุงุนุฏ ุงูุจูุงูุงุช.

**ุงูุญู:** ุชู ุฅุถุงูุฉ try-catch ูุชุฌุงูู ุงูุฎุทุฃ ุฅุฐุง ูุงู ุงูุนููุฏ ุบูุฑ ููุฌูุฏ.

## ุงูุจูุงูุงุช ุงููููุดุฃุฉ

### ุงูุญุณุงุจ ุงููููู
- **Email:** `test.chat.user@example.com`
- **Password:** `password123`
- **Name:** `Test Chat User`
- **ID:** `146`

### ุงูุดุงุช ุงูุชุฌุฑูุจู
- **Chat Room ID:** `78`
- **Type:** `private`
- **Participants:**
  - Test Chat User (ID: 146)
  - Madonna Nashaat Anwer Seha (ID: 120)

### ุฑุงุจุท ุงูุดุงุช
```
http://192.168.15.29/crm/stafftobia/public/chat/static?conversation=78
```

## ูุชุงุฆุฌ ุงูุงุฎุชุจุงุฑุงุช

### โ ุงุฎุชุจุงุฑ PHP
```
โ ุงูุจุญุซ ุนู ุงูุญุณุงุจ ุงููููู: ูุฌุญ
โ ุงูุจุญุซ ุนู ูุณุชุฎุฏู Madonna: ูุฌุญ
โ ุงูุจุญุซ ุนู ุงูุดุงุช: ูุฌุญ
โ ุฅุฑุณุงู ุฑุณุงูุฉ: ูุฌุญ
โ API endpoint: ูุฌุญ
```

### ๐ ุฅุญุตุงุฆูุงุช ุงูุดุงุช
- ุนุฏุฏ ุงูุฑุณุงุฆู: 5+ ุฑุณุงุฆู
- ุขุฎุฑ ุฑุณุงูุฉ: ุชู ุฅุฑุณุงููุง ุจูุฌุงุญ
- ุงูุงุณุชุฌุงุจุฉ: JSON ุตุญูุญ

## ุงูุฎุทูุงุช ุงูุชุงููุฉ

1. **ุงุฎุชุจุงุฑ ูู ุงููุฑููุช:**
   - ุชุณุฌูู ุงูุฏุฎูู ุจุญุณุงุจ ูููู
   - ูุชุญ ุงูุดุงุช ูุน Madonna
   - ุฅุฑุณุงู ุฑุณุงูุฉ ูุงูุชุญูู ูู ุธููุฑูุง

2. **ุงุฎุชุจุงุฑ Playwright (ุนูุฏ ุชููุฑ Node.js):**
   ```bash
   node tests/chat_test_playwright.js
   ```

3. **ูุฑุงูุจุฉ ุงูุฃุฎุทุงุก:**
   - ุงูุชุญูู ูู ุนุฏู ูุฌูุฏ ุฃุฎุทุงุก `runtime.lastError`
   - ุงูุชุญูู ูู ุฃู ุฌููุน ุงูุงุณุชุฌุงุจุงุช JSON ูููุณุช HTML

## ููุงุญุธุงุช ูููุฉ

1. **CSRF Token:** ุชุฃูุฏ ูู ุฅุฑุณุงู CSRF token ูุน ุฌููุน ุงูุทูุจุงุช
2. **Authentication:** ูุฌุจ ุชุณุฌูู ุงูุฏุฎูู ูุจู ุฅุฑุณุงู ุงูุฑุณุงุฆู
3. **Permissions:** ูุฌุจ ุฃู ูููู ุงููุณุชุฎุฏู ูุดุงุฑูุงู ูู ุงูุดุงุช

## ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ูุดููุฉ: ุงูุงุณุชุฌุงุจุฉ HTML ุจุฏูุงู ูู JSON
**ุงูุญู:** ุชุฃูุฏ ูู ุฅุฑุณุงู header `Accept: application/json` ูุน ุงูุทูุจ

### ูุดููุฉ: ุฎุทุฃ ูู CSRF
**ุงูุญู:** ุชุฃูุฏ ูู ุฅุฑุณุงู `X-CSRF-TOKEN` ูุน ุงูุทูุจ

### ูุดููุฉ: ุฎุทุฃ ูู ุงูุตูุงุญูุงุช
**ุงูุญู:** ุชุฃูุฏ ูู ุฃู ุงููุณุชุฎุฏู ูุดุงุฑู ูู ุงูุดุงุช

## ุงูุฏุนู

ูููุณุงุนุฏุฉ ุฃู ุงูุฅุจูุงุบ ุนู ูุดุงููุ ูุฑุฌู ูุชุญ issue ูู ุงููุดุฑูุน.

